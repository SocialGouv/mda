global:
  host: maisondelautisme-recette.fabrique.social.gouv.fr
  # host: maisondelautisme.gouv.fr #TODO enable when domain is ok

web:
  autoscale:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
  resources:
    limits:
      cpu: "350m"
      memory: "384Mi"
    requests:
      cpu: "250m"
      memory: "256Mi"
  envFrom:
    - secretRef:
        name: "mda-revalidate-webhook"
    - secretRef:
        name: "mda-web-smtp"

jobs:
  runs:
    build-web:
      with:
        buildArgs:
          PRODUCTION: "true"
          ROBOT: "true"
strapi:
  autoscale:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
  resources:
    limits:
      cpu: "500m"
      memory: "640Mi"
    requests:
      cpu: "400m"
      memory: "512Mi"
  addVolumes:
    - uploads
  volumeMounts:
    - mountPath: /app/apps/strapi/public/uploads
      name: uploads
  envFrom:
    - secretRef:
        name: "{{ .Values.global.pgSecretName }}"
    - secretRef:
        name: "mda-strapi"
    - secretRef:
        name: "mda-revalidate-webhook"
    - secretRef:
        name: "mda-meilisearch"
    - secretRef:
        name: "azure-mda-volume"

meilisearch:
  autoscale:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
  resources:
    limits:
      cpu: "350m"
      memory: "384Mi"
    requests:
      cpu: "250m"
      memory: "256Mi"
